<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>420 Store | Panel Vendedores</title>
  <link rel="stylesheet" href="css/estilos.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    .dashboard {
      padding: 2em 5%;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5em;
    }

    .stat-card {
      background: linear-gradient(135deg, #1a1a1a, #0b0b0b);
      border: 1px solid #b8860b;
      border-radius: 15px;
      padding: 1.5em;
      text-align: center;
      transition: 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(218,165,32,0.3);
    }

    .stat-card h3 {
      color: #daa520;
      font-size: 2.5rem;
      margin: 0.5em 0;
    }

    .stat-card p {
      color: #999;
      font-size: 0.9rem;
    }

    .panel {
      background: #111;
      border: 1px solid #b8860b;
      border-radius: 15px;
      padding: 2em;
      margin: 2em 5%;
    }

    .panel h2 {
      color: #daa520;
      margin-bottom: 1em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #b8860b;
      padding: 0.8em;
      text-align: center;
      color: #eee;
    }

    th {
      background: #1a1a1a;
      color: #daa520;
      font-weight: 600;
    }

    tr:hover {
      background: #1a1a1a;
    }

    .btn-admin {
      background: transparent;
      border: 2px solid #b8860b;
      color: #daa520;
      padding: 0.5em 1.2em;
      border-radius: 20px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 0.85rem;
      margin: 0 0.25em;
    }

    .btn-admin:hover {
      background: #b8860b;
      color: #000;
      transform: scale(1.05);
    }

    .btn-admin.danger {
      border-color: #ff4444;
      color: #ff4444;
    }

    .btn-admin.danger:hover {
      background: #ff4444;
      color: #fff;
    }

    .bienvenida {
      background: #1a1a1a;
      border: 1px solid #4CAF50;
      border-radius: 10px;
      padding: 1em;
      margin: 1em 5%;
      text-align: center;
      color: #4CAF50;
    }

    .tabs {
      display: flex;
      gap: 1em;
      margin: 2em 5% 0;
      border-bottom: 2px solid #b8860b;
    }

    .tab {
      background: transparent;
      border: none;
      color: #999;
      padding: 1em 2em;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      border-bottom: 3px solid transparent;
    }

    .tab.active {
      color: #daa520;
      border-bottom-color: #daa520;
    }

    .tab:hover {
      color: #daa520;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>

<body>

<header>
  <h1>420 STORE - Vendedores</h1>
  <nav>
    <a href="index.html">Tienda</a>
    <a href="vendedores.html" class="active">Mi Panel</a>
    <a href="admin.html">AdministraciÃ³n</a>
    <span id="nombre-vendedor" style="color:#daa520;margin-left:1em;"></span>
    <a href="php/logout.php" style="color:#ff4444;margin-left:1em;">Cerrar SesiÃ³n</a>
  </nav>
</header>

<section class="hero">
  <h2>Panel de Vendedores</h2>
  <p>Gestiona tus ventas y productos</p>
</section>

<div class="bienvenida" id="bienvenida" style="display:none;">
  âœ… SesiÃ³n de vendedor activa
</div>

<!-- ESTADÃSTICAS -->
<div class="dashboard">
  <div class="stat-card">
    <p>Productos Totales</p>
    <h3 id="stat-productos">-</h3>
  </div>
  <div class="stat-card">
    <p>Pedidos Totales</p>
    <h3 id="stat-pedidos">-</h3>
  </div>
  <div class="stat-card">
    <p>Ventas Totales</p>
    <h3 id="stat-ventas">$0</h3>
  </div>
  <div class="stat-card">
    <p>Usuarios Registrados</p>
    <h3 id="stat-usuarios">-</h3>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab active" onclick="cambiarTab('productos')">Mis Productos</button>
  <button class="tab" onclick="cambiarTab('pedidos')">Pedidos Recientes</button>
  <button class="tab" onclick="cambiarTab('vendedores')">Otros Vendedores</button>
</div>

<!-- TAB: MIS PRODUCTOS -->
<div class="tab-content active" id="tab-productos">
  <div class="panel">
    <h2>ðŸ“¦ Mis Productos</h2>
    <button class="btn-admin" onclick="window.location.href='admin.html'" style="margin-bottom:1em;">
      âž• Agregar Nuevo Producto
    </button>
    <table id="tablaProductos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>CategorÃ­a</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="6" style="padding:2em;">Cargando productos...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- TAB: PEDIDOS RECIENTES -->
<div class="tab-content" id="tab-pedidos">
  <div class="panel">
    <h2>ðŸ“‹ Pedidos Recientes</h2>
    <table id="tablaPedidos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Fecha</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="5" style="padding:2em;">Cargando pedidos...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- TAB: OTROS VENDEDORES -->
<div class="tab-content" id="tab-vendedores">
  <div class="panel">
    <h2>ðŸ‘¥ Otros Vendedores</h2>
    <button class="btn-admin" onclick="window.location.href='registrar_Vendedor.html'" style="margin-bottom:1em;">
      âž• Registrar Nuevo Vendedor
    </button>
    <table id="tablaVendedores">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>TelÃ©fono</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="5" style="padding:2em;">Cargando vendedores...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<footer>
  <p>Â© 2025 420 STORE - Panel de Vendedores</p>
</footer>

<script>
  const API_BASE = 'php/';

  // VERIFICAR SESIÃ“N DE VENDEDOR
  document.addEventListener('DOMContentLoaded', async () => {
    console.log('ðŸ” Verificando sesiÃ³n de vendedor...');
    
    try {
      const response = await fetch('php/verificar_vendedor.php');
      const result = await response.json();
      
      console.log('Resultado:', result);
      
      if (!result.success || !result.data.es_vendedor) {
        alert('Acceso denegado. Debes iniciar sesiÃ³n como vendedor.');
        window.location.href = 'login.html';
        return;
      }
      
      // Mostrar informaciÃ³n del vendedor
      const vendedor = result.data.vendedor;
      document.getElementById('nombre-vendedor').textContent = 'ðŸ‘¤ ' + vendedor.nombre;
      document.getElementById('bienvenida').style.display = 'block';
      document.getElementById('bienvenida').textContent = `âœ… Bienvenido, ${vendedor.nombre}`;
      
      // Cargar datos
      cargarEstadisticas();
      cargarProductos();
      
    } catch (error) {
      console.error('Error:', error);
      alert('Error de autenticaciÃ³n');
      window.location.href = 'login.html';
    }
  });

  // CARGAR ESTADÃSTICAS
  async function cargarEstadisticas() {
    try {
      const response = await fetch(`${API_BASE}admin.php?accion=estadisticas`);
      const result = await response.json();
      
      if (result.success) {
        document.getElementById('stat-usuarios').textContent = result.data.total_usuarios;
        document.getElementById('stat-productos').textContent = result.data.total_productos;
        document.getElementById('stat-pedidos').textContent = result.data.total_pedidos;
        document.getElementById('stat-ventas').textContent = '$' + Number(result.data.ventas_totales).toLocaleString();
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // CARGAR PRODUCTOS
  async function cargarProductos() {
    try {
      const response = await fetch(`${API_BASE}obtenerProductos.php?accion=listar&limite=50`);
      const result = await response.json();
      
      if (result.success) {
        const tbody = document.querySelector('#tablaProductos tbody');
        tbody.innerHTML = '';
        
        result.data.productos.forEach(prod => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${prod.id}</td>
            <td>${prod.nombre}</td>
            <td>$${Number(prod.precio).toLocaleString()}</td>
            <td>${prod.stock}</td>
            <td>${prod.categoria}</td>
            <td><span style="color:#4CAF50">${prod.estado}</span></td>
          `;
          tbody.appendChild(tr);
        });
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // CARGAR PEDIDOS
  async function cargarPedidos() {
    try {
      const response = await fetch(`${API_BASE}admin.php?accion=listar_pedidos&limite=20`);
      const result = await response.json();
      
      if (result.success) {
        const tbody = document.querySelector('#tablaPedidos tbody');
        tbody.innerHTML = '';
        
        result.data.pedidos.forEach(ped => {
          const fecha = new Date(ped.fecha_pedido).toLocaleDateString();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${ped.id}</td>
            <td>${ped.usuario_nombre}</td>
            <td>$${Number(ped.total).toLocaleString()}</td>
            <td><span style="color:#4CAF50">${ped.estado}</span></td>
            <td>${fecha}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // CARGAR VENDEDORES
  async function cargarVendedores() {
    try {
      const response = await fetch(`${API_BASE}admin.php?accion=listar_vendedores`);
      const result = await response.json();
      
      if (result.success && result.data.vendedores) {
        const tbody = document.querySelector('#tablaVendedores tbody');
        tbody.innerHTML = '';
        
        result.data.vendedores.forEach(vend => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${vend.id}</td>
            <td>${vend.nombre}</td>
            <td>${vend.email}</td>
            <td>${vend.telefono || 'N/A'}</td>
            <td><span style="color:${vend.estado === 'activo' ? '#4CAF50' : '#ff4444'}">${vend.estado}</span></td>
          `;
          tbody.appendChild(tr);
        });
      } else {
        const tbody = document.querySelector('#tablaVendedores tbody');
        tbody.innerHTML = '<tr><td colspan="5">No hay datos disponibles</td></tr>';
      }
    } catch (error) {
      console.error('Error:', error);
      const tbody = document.querySelector('#tablaVendedores tbody');
      tbody.innerHTML = '<tr><td colspan="5">Error al cargar vendedores</td></tr>';
    }
  }

  // CAMBIAR TAB
  function cambiarTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById('tab-' + tab).classList.add('active');
    
    if (tab === 'productos') cargarProductos();
    if (tab === 'pedidos') cargarPedidos();
    if (tab === 'vendedores') cargarVendedores();
  }
</script>

</body>
</html>